!function(){var e={name:"sojs",namespace:"",classes:{},noop:function(){},$sojs:function(){var e={};if("undefined"!=typeof window&&window&&"undefined"!=typeof document&&document?(this.runtime="browser",e.global=window):(this.runtime="node",e.global=global),e.proxyName="proxy",e.path="node"===this.runtime?process.cwd()+"/src/":"/src/","undefined"!=typeof $sojs_config)for(var t in $sojs_config)t&&$sojs_config.hasOwnProperty(t)&&(e[t]=$sojs_config[t]);this.global=e.global,e.proxyName&&(Function.prototype[e.proxyName]=this.proxy),this.setPath(e.path),this.global.sojs=this.global.sojs||this},path:{},pathCache:{},getPath:function(e){var t=e?e.split("."):!1,s=this.path;if(t)for(var i=0,r=t.length;r>i;i++){var n=t[i].toLowerCase();if(!s[n])break;s=s[n]}return s.pathValue},setPath:function(e,t){var s=this.path;if("object"!=typeof e){if(t)for(var i=e.split("."),r=0,n=i.length;n>r;r++){var a=i[r].toLowerCase();s[a]=s[a]||{pathValue:s.pathValue},s=s[a]}else t=e;s.pathValue=t,this.pathCache={}}else for(var o in e)o&&e.hasOwnProperty(o)&&this.setPath(o,e[o])},getClassPath:function(e){if(!this.pathCache[e]){this.pathCache[e]=this.getPath(e)+e.replace(/\./gi,"/")+".js";var t=this.getPath(e),s=t.length-1;t.lastIndexOf("\\")!==s&&t.lastIndexOf("/")!==s&&(t+="/"),this.pathCache[e]=t+e.replace(/\./gi,"/")+".js"}return this.pathCache[e]},loadDeps:function(e,t){t=t||{};var s=e.__deps,i=(e.__namespace,[]);for(var r in s)if(s.hasOwnProperty(r)&&s[r]){var n;if("string"!=typeof s[r]?(e[r]=s[r],e[r]&&e[r].__name&&(n=e[r].__full)):(n=s[r],e[r]=this.find(n)),!n||t[n])continue;if(t[n]=!0,e[r])e[r].__deps&&(i=i.concat(this.loadDeps(e[r],t)));else{if("node"===this.runtime)try{e[r]=require(this.getClassPath(n))}catch(a){i.push(n)}e[r]||i.push(n)}}return i},fastClone:function(e){var t=function(){};t.prototype=e;var s=new t;return s},deepClone:function(e,t){"number"!=typeof t&&(t=10);var s,i=t-1;if(t>0)if(e instanceof Date)s=new Date,s.setTime(e.getTime());else if(e instanceof Array){s=[];for(var r=0,n=e.length;n>r;r++)s[r]=this.deepClone(e[r],i)}else if("object"==typeof e){s={};for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];s[a]=this.deepClone(o,i)}}else s=e;else s=e;return s},proxy:function(e,t){var s=Array.prototype.slice.apply(arguments),i=s.shift(),r="function"==typeof this?this:s.shift();return function(){var e=Array.prototype.slice.apply(arguments);return r.apply(i,e.concat(s))}},find:function(e){var t,s=e.split(".");t=this.classes[s[0]];for(var i=1,r=s.length;r>i;i++){if(!t||!t[s[i]]){t=null;break}t=t[s[i]]}return t},reload:function(e){var t=this.find(e);if(t)if(t.__registed=!1,"node"===this.runtime){var s=this.getClassPath(e);delete require.cache[require.resolve(s)],t=require(s)}else t=this.define(t);else t=this.using(e);return t},create:function(e,t,s,i,r,n){"string"==typeof e&&(e=this.using(e));var a=new e.__constructor(t,s,i,r,n);return a},using:function(e){var t=this.find(e);return t||"node"===this.runtime&&(require(this.getClassPath(e)),t=this.find(e)),t},define:function(e){var t=e.name||"__tempName";if("node"===this.runtime&&"undefined"==typeof e.namespace){var s=arguments.callee.caller.arguments[4];s&&(e.namespace=s.substring(s.indexOf("src")+4).replace("//",".").replace("\\","."),e.namespace=require("path").relative(this.getPath(),s).replace("//",".").replace("\\","."))}var i=e.namespace||"";e.__name=t,e.__namespace=i,e.__full=i.length>1?i+"."+t:t,e.__deps=e.deps,e.__sojs=this,e.__constructor=function(e,t,s,i,r){if(this.__clones&&this.__clones.length>0)for(var n=0,a=this.__clones.length;a>n;n++){var o=this.__clones[n];this[o]=this.__sojs.deepClone(this[o])}this.__constructorSource(e,t,s,i,r)},e.__constructorSource=e[t]||this.noop,e.__staticSource=e["$"+t]||this.noop,e.__staticUpdate=function(){var t=[];for(var s in this)if(this.hasOwnProperty(s)){var i=this[s];"object"!=typeof i||null===i||"deps"===s||0===s.indexOf("__")||e.__deps&&e.__deps[s]||t.push(s)}this.__clones=t,this.__constructor.prototype=this},e.__static=function(){this.__staticSource(),this.__staticUpdate()};for(var r,n=i.split("."),a=n.length,o=this.classes,h=0;a>h;h++)r=n[h],r&&(o[r]=o[r]||{},o=o[r]);o[t]=o[t]||{};var l=o;if(o=o[t],!o.__name||!o.__registed){e.__registed=!0,l[t]=e,e=l[t];var c=this.loadDeps(e);if(c.length>0){if(this.loader=this.loader||this.using("sojs.loader"),"browser"!==this.runtime||!this.loader)throw new Error('class "'+e.name+'" loadDeps error:'+c.join(","));this.loader.loadDepsBrowser(e,c)}else e.__static()}return"node"===this.runtime&&arguments.callee.caller.arguments[2]&&(arguments.callee.caller.arguments[2].exports=e),e}};e.define(e)}();